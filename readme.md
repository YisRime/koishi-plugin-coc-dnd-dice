# koishi-plugin-coc-dnd-dice

[![npm](https://img.shields.io/npm/v/koishi-plugin-coc-dnd-dice?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-coc-dnd-dice)

多功能跑团（TRPG）骰点插件，内置对《克苏鲁的呼唤》（CoC7）和《龙与地下城》（D&D5E）等多种规则的支持。

## ✨ 功能特性

- **🎲 基础投掷与检定**：支持多种格式的骰子表达式（如 `d20`, `3d6`）和通用的技能检定。
- **📜 角色卡系统**：创建、管理和绑定多张角色卡，自动记录角色属性和技能，实现数据持久化。
- **🐙 CoC7 规则支持**：
  - 快速生成 CoC7 调查员属性。
  - 自动计算成功等级的技能检定。
  - 支持奖励骰、惩罚骰和对抗检定。
  - 内置理智检定（San Check）、技能成长、疯狂症状表等常用功能。
- **🐉 D&D5E 规则支持**：
  - 快速生成 D&D5E 角色属性（4d6 去低）。
  - 支持优势/劣势掷骰。
  - 便捷的先攻列表管理工具。
  - 内置多种族随机姓名生成器。
- **🔧 高度可定制化**：
  - 所有游戏数据（技能、职业、疯狂症状等）均通过 JSON 模板管理。
  - 支持导出、修改和加载自定义模板，轻松实现房规定制。

## 📝 命令参考

### 通用指令

| 命令 | 示例 | 说明 |
| --- | --- | --- |
| `r [表达式]` | `.r d20` / `.r 3d6` | 掷一个或多个骰子。表达式支持 `d20`、`3d6`、`20` (等同于`d20`) 等格式。 |
| `ra <技能> [目标值]` | `.ra 侦查 70` | 进行一次通用的技能检定，自动判断成功等级。 |
| `ra <技能> <目标值> @成员` | `.ra 侦查 70 @张三` | 代替指定成员进行检定。 |

---

### 角色卡管理

| 命令 | 示例 | 说明 |
| --- | --- | --- |
| `pc.new <名称>` | `.pc.new 调查员A` | 创建一张新的空白角色卡并自动绑定。 |
| `pc.list` | `.pc.list` | 列出你拥有的所有角色卡。 |
| `pc.tag <名称>` | `.pc.tag 调查员A` | 切换并绑定一张已存在的角色卡。 |
| `pc.del <名称>` | `.pc.del 调查员A` | 删除指定的角色卡。 |
| `nn <新名称>` | `.nn 资深调查员` | 重命名当前绑定的角色卡。 |
| `sn` | `.sn` | 显示当前绑定角色卡的详细信息（名片）。 |
| `st <属性> [值]` | `.st 力量 60` / `.st 力量` | 设置或查看当前角色卡的属性/技能值。 |
| `st.show [属性]` | `.st.show` | 显示角色卡的所有属性和技能。 |
| `ra <技能>` | `.ra 侦查` | 使用当前绑定角色卡的技能值进行检定。 |

---

### CoC7 规则指令

| 命令 | 示例 | 说明 |
| --- | --- | --- |
| `coc [数量]` | `.coc` / `.coc 3` | 生成一组或多组 CoC7 调查员属性。 |
| `st.init [职业]` | `.st.init` / `.st.init 医生` | 初始化当前角色卡的全部基础技能，或根据指定职业模板进行初始化。 |
| `st.occupations` | `.st.occupations` | 显示所有预设的 CoC7 职业模板。 |
| `st.equipment [分类]` | `.st.equipment 武器` | 查询预设的装备列表。 |
| `sc <成功损失>/<失败损失>` | `.sc 1/1d6` | 进行理智检定 (San Check)。 |
| `rab [数量] <技能> [目标值]` | `.rab 侦查 70` / `.rab 2 侦查 70` | 进行奖励骰检定，默认1个奖励骰。 |
| `rap [数量] <技能> [目标值]` | `.rap 侦查 70` / `.rap 2 侦查 70` | 进行惩罚骰检定，默认1个惩罚骰。 |
| `rav <技能1> <技能2> [@成员]` | `.rav 侦查 潜行` | 进行对抗检定。 |
| `en <技能>` | `.en 侦查` | 对已成功的技能进行成长检定。 |
| `ti` | `.ti` | 获取一个随机的即时疯狂症状。 |
| `li` | `.li` | 获取一个随机的总结性疯狂症状。 |
| `setcoc [房规ID]` | `.setcoc 1` / `.setcoc details` | 设置或查看当前使用的房规。 |

---

### D&D5E 规则指令

| 命令 | 示例 | 说明 |
| --- | --- | --- |
| `dnd [数量]` | `.dnd` / `.dnd 3` | 生成一组或多组 D&D5E 角色属性 (4d6k3)。 |
| `r d优势` | `.r d优势` | 进行优势掷骰 (掷两次d20取高)。 |
| `r d劣势` | `.r d劣势` | 进行劣势掷骰 (掷两次d20取低)。 |
| `rc [优势/劣势] <技能>[调整值]` | `.rc 运动` / `.rc 优势 运动+5` | 进行 D&D5E 技能检定。 |
| `ri [名称]` | `.ri` / `.ri 地精A` | 为自己或指定 NPC 掷先攻，并加入先攻列表。 |
| `init` | `.init` | 显示按顺序排列的先攻列表。 |
| `init.clear` | `.init.clear` | 清空先攻列表。 |
| `namednd <种族> [数量]` | `.namednd 精灵` / `.namednd 人类 3` | 生成指定种族的随机姓名。 |

---

### 模板管理 (高阶)

| 命令 | 示例 | 说明 |
| --- | --- | --- |
| `template.list` | `.template.list` | 列出所有可用的数据模板。 |
| `template.show <名称> [路径]` | `.template.show coc7_skills.力量` | 查看模板的具体内容。 |
| `template.export` | `.template.export` | 将所有内置模板导出为 JSON 文件，方便自定义。 |
| `template.reload` | `.template.reload` | 清除模板缓存，重新从文件加载模板。 |
| `template.load <文件名>` | `.template.load my_rules.json` | 加载一个自定义的模板文件。 |

## 🔧 自定义与扩展

本插件的核心数据，如 CoC7 的技能列表、职业、D&D 的种族姓名等，都由模板驱动。你可以通过以下步骤实现高度自定义和房规设置：

1. **导出默认模板**：使用命令 `.template.export`，插件会将所有内置模板导出为 `.json` 文件，存放在 Koishi 数据目录下的 `templates` 文件夹内。
2. **修改或创建模板**：你可以直接编辑这些导出的 JSON 文件，或者创建新的模板文件。例如，你可以修改 `coc7_skills.json` 来调整技能初始值，或者创建一个 `my_house_rules.json` 来定义自己的房规。
3. **重载模板**：修改文件后，使用 `.template.reload` 命令，插件会清除缓存并加载你的自定义设置，使其立即生效。

这种设计让你可以轻松地将任何跑团规则的数据集成到插件中，并与你的跑团团队共享。
